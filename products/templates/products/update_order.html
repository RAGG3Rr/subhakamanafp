{% extends "base.html" %}
{% load crispy_forms_tags %}
{% block content %}
<div class="container mt-3">
    <div class="row">
        <div class="col-md-6">
            <div class="card p-3">
                <h5 class="text-center mb-3">User Information</h5>
                <p>Name: {{orders.customer.first_name}} {{orders.customer.last_name}}</p>
                <p>Email: {{orders.customer.email}}</p>
                <p>Username: {{orders.customer}}</p>
                <p>Phone: {{address.phone|safe}}</p>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card p-3">
                <h5 class="text-center mb-3">Shipping Information</h5>
                <p>Address: {{address.address}}</p>
                <p>City: {{address.city}}</p>
                <p>Provience: {{address.state}}</p>
                <p>Zipcode: {{address.zipcode|safe}}</p>
            </div>
        </div>
    </div>
    <form action="{%url 'update_order' order_id%}" method="POST" class="mt-3">
        {% csrf_token %}
        {{form|crispy}}
        {{pform|crispy}}
        <button class="btn btn-secondary" type="submit">Save</button>
    </form>
    <table class="table mt-3" id="myTable">
        <thead class="thead-dark">
        <tr>
            <th scope="col">S.N.</th>
            <th scope="col">Ordered Date</th>
            <th scope="col">Product</th>
            <th scope="col">Quantity</th>
            <th scope="col">Price</th>
        </tr>
        </thead>
        <tbody>
            {% for item in order_items %}
            <tr>
                <td>{{forloop.counter}}</td>
                <td style="width: 20%;">{{item.order.date_ordered}}</td>
                <td>{{item.product}}
					<p style="color:blue;margin:0px 0px;">
						Size:  {{item.features|default_if_none:''}}
						</p>
						<p style="color:blue;margin:0px 0px;">
						Color:  {{item.colors|default_if_none:''}}</p>
				</td>
                <td>{{item.quantity}}</td>
                <td>{% widthratio item.price 1 item.quantity %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="float-right">
        <p><strong>Total:</strong> Rs.{{total}}</p> <br>
        <p><strong>Shipping:</strong> Rs.{{shipping}}</p><br>
        <p><strong>Grand Total:</strong> Rs.{{grand_total}}</p>
    </div>
    <div class="clearfix"></div>
</div>
<script>
    $(".modal-body #proceedorder").click(function(e) {
        e.preventDefault();
        var status = $('#id_order_status').val();
        var orderid = '{{orders.id|safe}}';
        $.ajax({
        url: '/update_orderstatus/',
        data: {
            'status': status,
            'orderid':orderid
        },
        success: function (data){
                console.log(data);
                window.location.reload();
                $('#updateorderstatus').text(data);
            },
        error: function(data) {
            console.log(data);
        },
        })
    });

</script>
{% endblock %}