{% extends "base.html"%}
{% load static %}
{%block css%}
    <!-- Data Tables -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/dataTables.bootstrap4.min.css">
{%endblock%}
{% block content%}
<h2 class="text-center mt-3 mb-3">Orders Received</h2>
<div class="container">
    <table class="table" id="myTable">
        <thead class="thead-dark">
          <tr>
            <th scope="col">S.N.</th>
            <th scope="col">Transaction ID</th>
            <th scope="col">User</th>
            <th scope="col">Ordered Date</th>
            <th scope="col">Status</th>
            <th scope="col">Payment Mode</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr class="{% if order.customer == None%}table-danger{%endif%}">
                <td>{{forloop.counter}}</td>
                <td>{{order.transaction_id}}</td>
                <td>{{order.customer}}</td>
                <td>{{order.date_ordered}}</td>
                {% for delivery in status%}
                    {% if delivery.order_id|safe == order.id|safe%}
                        <td>{{delivery.order_status}}</td>
                    {% endif%}
                {% endfor %}

                {% for mode in payment_mode %}
                    {% if mode.order_id|safe == order.id|safe%}
                        <td>{{mode.payment_mode}}</td>
                    {% endif%}
                {% endfor %}

                <td> 
                    <a href="{% url 'order-detail' order.id|safe %}"><i class="fas fa-eye pr-2" style="color: green"></i></a>
                    <a href="{% url 'update_order' order.id|safe%}"><i class="fas fa-edit pr-2" style="color: #000;"></i></a>
                    <a href="#" class="ord_delete" data-id="{{order.id|safe}}"><i class="fas fa-trash-alt pr-2" style="color: red;" data-toggle="modal" data-target="#deleteorder"></i></a>
					
                    <!-- Modal -->
                    <div class="modal fade" id="deleteorder" tabindex="-1" role="dialog" aria-labelledby="deleteorderTitle" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                            <h5 class="modal-title" id="deleteorderTitle">Delete Order</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            </div>
                            <div class="modal-body">
                                Are you sure you want to delete this order? 
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <form action="{% url 'delete_order' order.id|safe %}" method="POST" >
                                    {% csrf_token %}
									<input type="hidden" name="deleteorder" id="delorder" value=""/>
                                    <button type="submit" class="btn btn-danger">Delete</button>
                                </form>
                            </div>
                        </div>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap4.min.js"></script>
<script>
    $(document).ready( function () {
        $('#myTable').DataTable({
            searching: true,
            ordering: false,
            lengthMenu: [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
            // dom: '<"top">rt<"bottom"lfp><"clear">',
        });
    } );
	  
	$('.ord_delete').click(function(){
		var newid = $(this).data('id');
		$(".modal-footer #delorder").val(newid);
	});
	
	
</script>
{% endblock %}